---
title: "Explanation of Test Statistics"
author: "Conrad Cartmell"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Explanation of Test Statistics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The test statistics utilized in the `maRkov` package are drawn from the paper "Exact goodness-of-t tests for Markov chains" by Julian Besag and Debashis Mondal. This vignette will attempt to give a brief introduction to them so that the user of the `maRkov` package may better understand the guts of the included programs.

The general principle underpinning the package is that it is possible to use single or multiple real sequences of binary data to produce a set of possible exchangeable sequences that are generated to preserve a certain property found in the original chain. This property is the count of transitions between states of the chain. For example, the chain of data `a = { 1, 0, 0, 0, 1, 0, 1}` has two transitions from 1 to 0, two transitions from 0 to 0, and two transitions from 0 to 1. An example of a different chain with the same transition counts would be `b = { 1, 0, 0, 1, 0, 0, 1}`.

In order to generate a large number of such chains that are independent of the original one, the the procedure attempts swapping entries in the supplied chain `c` some number `n` times. For each attempted swap, the chain is checked to make sure that the transition counts are the same. If they are, the swap is made and the chain is saved. If not, another swap is attempted. The swaps that are attempted are determined by randomly generating indices of the chains.

Once `n` swaps have been attempted, the resulting chain of data, here referred to as `d` is saved. Then, using `d` as a starting point for each new chain, the procedure attempts `n` _more_ swaps, after which it saves the resulting chain. However many chains of generated data are desired are created in this fashion from `d`, and all are independent from the original supplied chain `c`.

Once the program has generated a sufficient amount of data, it goes about generating test statistics. Since the test statistics in the `maRkov` package are concerned with determining the appropriateness of first order chains against second order ones, a table of second order transition counts is compiled. From this table, the program generates test statistics using the following formulae to test the alternative hypothesis that a first order binary Markov chain is insufficient to describe the sequence against the null hypothesis that the simple binary markov chain is adequet. The $\chi^2$ distribution approximates the distribution of likelihood ratio test statistics.  The below euqations are for single chains.

$$ LRT = 2 \sum_{i,j,k}^{} n_{ijk} log\Bigg(\frac{\frac{n_{ijk}}{n_{ij+}}}{\frac{n_{+jk}}{n_{+j+}}}\Bigg) $$

$$ X^2 = \sum_{i,j,k}^{} \frac{\bigg(n_{ijk}-\frac{n_{ij+}n_{+jk}}{n_{+j+}}\bigg)^2}{\frac{n_{ij+}n_{+jk}}{n_{+j+}}} $$

Where $n_{ijk}$ represents the frequency of the transition from state $ij$ to state $jk$ in a second order chain. The $n's$ with $+$ in the subscript indicate summation across all values of either $i, j, k$ or some combination thereof.

Run test statistics are also included in the package, and those simply represent the number of times that a run of a certain specified length occurs within the chain. The exact formula is shown below for a run of length $p$, where $x_i$ is the $i^{th}$ index of a sequence of data $x$ of length $l$.

$$ Run = \sum_{i=1}^{l-p} \mathbb{I}_{x_i=x_{i+1}=...=x_{i+p-1}=x_{i+p}}(i) $$

For multiple binary chains, the test statistics are slightly different. The liklihood ratio test statistic tests, in this case, the null hypothesis that a single transition matrix is appropriate for every sequence in the set of chains against the alternative hypothesis that multiple transition matricies are required. The $\chi^2$ distribution is once again an approximation of the distribution of likelihood ratio test statistics.

$$ LRT = 2 \sum_{i,j,k,t}^{} n_{ijk}^{(t)}*log\Bigg(\frac{\frac{n_{ijk}^{(t)}}{n_{ij+}^{(t)}}}{\frac{n_{+jk}^{(t)}}{n_{+j+}^{(t)}}}\Bigg) $$

$$ X^2 = \sum_{t=0}^{n} \sum_{i,j}^{} \frac{{\Bigg(n_{ij}^{(t)}-\frac{n_{i+}^{(t)}n_{ij}^{(+)}}{n_{i+}^{(+)}}\Bigg)}^2}{n_{i+}^{t}+\frac{n_{ij}^{(+)}}{n_{i+}^{(+)}}} $$

Where $n_{ijk}^{(t)}$ represents the frequency of the transition from state $ij$ to state $jk$ in the $t^{th}$ chain in the set. $+$ indicates the same thing as in the single chain case.

The run test statistic is calculated in the same fashion as the run test statistic in the single sequence case, but the run test statistics from each sequence are added together. The exact formula is shown below for a run of length $p$, where $x_i^{(j)}$ is the $i^{th}$ index of a sequence of data $x^{(j)}$ within a set of $n$ sequences $x$, all of length $l$.

$$ Run = \sum_{j=1}^{n} \sum_{i=1}^{l-p} \mathbb{I}_{x_i^{(j)}=x_{i+1}^{(j)}=...=x_{i+p-1}^{(j)}=x_{i+p}^{(j)}}(i) $$
